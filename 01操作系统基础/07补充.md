# 1.操作系统的基本概念

---

1. 操作系统管理计算机的 **硬件** 和 **软件** 资源，这两个统称为 **计算机资源** 。

文件**不属于**硬件资源，而是**软件资源**的一种！换句话说，文件是存储在磁盘上的 **数据**，属于软件资源，而磁盘本身才是硬件资源。

硬件资源是指计算机系统中的 **物理设备**，包括：
- **CPU**（中央处理器）
- **内存（RAM）**
- **磁盘存储（HDD/SSD）**
- **输入设备（键盘、鼠标）**
- **输出设备（显示器、打印机）**
- **网络设备（网卡、路由器）**

这些资源是 **看得见、摸得着的物理设备**，操作系统需要对它们进行管理，以提供稳定的运行环境。

软件资源是指 **存储在计算机上的数据和程序**，包括：
- **文件**（文本文件、图片、音视频、文档等）
- **进程**（运行中的程序）
- **库（Libraries）**（供程序调用的代码）
- **系统调用（System Calls）**
- **数据库**

---

2. 操作系统最基本的特征：**并发** 和 **共享**，两者互为存在条件。

---

3. 并发和并行：
    - 并发：若干事件在 **同一时间间隔内** 完成。
    - 并行：若干事件在 **同一时刻** 完成。

---

4. 操作系统主要向用户提供 **命令接口** 和 **程序接口（系统调用）** 。提供的图形接口是通过 **系统调用** 实现的功能。

系统调用：操作系统为应用（用户程序）使用内核功能所提供的接口。因为操作系统不允许用户直接操作各种硬件资源。
命令接口：联机用户接口和脱机用户接口。

---

5. 库函数和系统调用的区别和联系：
    库函数是语言或应用程序的一部分，可以运行在用户空间中。系统调用是操作系统的一部分，是内核为用户提供的程序接口，运行在内核空间中，并且许多库函数都使用系统调用来实现功能。未使用系统调用的库函数，其执行效率通常要比系统调用的高。因为使用系统调用时，需要上下文的切换及状态的转换（由用户态转向核心态）。

---

# 2.操作系统发展历程

---

1. 脱机技术：指在主机以外的设备上进行输入/输出操作。需要时再送主机处理，以提高设备利用率。

---

2. 提高单机资源利用率的关键技术是 **多道程序设计技术** 。该技术可以同时在内存中运行多个程序，在一个程序等待时，可以去执行其它程序。

---

3. 多道程序设计的基本特征：制约性、间断性、共享性。

---

4. 操作系统 **基本类型**：批处理操作系统、分时操作系统和实时操作系统。

下面是根据根据工作方式分类：

| **操作系统类型**          | **特点**                            | **代表系统**              |
| ------------------------- | ----------------------------------- | ------------------------- |
| **批处理操作系统**        | 按批次处理任务，用户无实时交互      | IBM OS/360、Linux `cron`  |
| **分时操作系统**          | 多个用户共享 CPU，快速切换任务      | Linux、Windows、Unix      |
| **实时操作系统（RTOS）**  | 硬/软实时要求，严格控制任务执行时间 | QNX、VxWorks、RTLinux     |
| **网络操作系统（NOS）**   | 主要用于网络管理和远程访问          | Windows Server、Cisco IOS |
| **分布式操作系统（DOS）** | 多台计算机协同工作，像一个整体      | Amoeba、Google Fuchsia    |
| **嵌入式操作系统**        | 用于智能设备，体积小、功耗低        | FreeRTOS、Zephyr、Android |

---

5. 设计实时操作系统的主要追求目标：安全性、可靠性、实时性。

---

6. 时间片：操作系统分时调度中分配给每个进程（或线程）的一小段 CPU 执行时间。当一个进程的时间片用完后，CPU 会被操作系统调度给下一个进程，使多个进程能够轮流执行，从而实现 **并发** 。（简单理解：时间片就像超市收银台的排队规则，每个人最多结账 1 分钟，超时就必须让给下一位顾客，等下一轮再来结账。）

---

7. 改善系统响应时间的方式：采用 **优先级+非抢占式调度算法** 。既可使重要的作业/进程通过高优先级尽快获得系统响应，又可保证次要的作业/进程在非抢占式调度下不会迟迟得不到系统响应。

---

8. 分时操作系统追求的目标： **快速响应用户** 。分时系统的响应时间 T 可表示为 \(T \approx QN\)，其中 Q 是时间片。而 N 是用户数。

---

9. 操作系统的基本特点：**并发**、**共享**、**虚拟**、**异步**。**最基本**且 **必须** 要实现的是并发和共享。

---

10. 进程多并不意味着 CPU 利用率高，进程数量越多，进程之间的资源竞争越激烈，甚至可能因为资源竞争而出现 **死锁** 现象，导致 CPU 利用率低。

---

11. 甘特图：

![alt text](imgs/甘特图.png)

画图时要注意，如处理器、打印设备等资源是 **不能让两个程序同时使用** 的，有一个程序正在使用时，其他程序的请求只能排队。

步骤：
- 横坐标上标出合适的时间间隔，纵坐标上的点是程序的名字。
- 过横坐标上每个标出的时间点，向上作垂直于横坐标的虚线。
- 用几种不同的线（推荐用“直线”“波浪线”“虚线”三种，较易区分）代表对不同资源的占用，按照题目给出的任务时间片，平行于横坐标把不同程序对应的线段分别画出来。

---

# 3.操作系统的运行环境

---

1. 操作系统执行程序时，必须从起始地址开始执行。

---

2. 批处理的主要缺点： **缺少交互性** 。

---

3. 操作系统的特权指令和非特权指令
 
> 特权指令是只有操作系统内核（Kernel Mode）才能执行的指令，而非特权指令是用户程序（User Mode）可以自由执行的指令。普通用户程序如果尝试执行特权指令，会触发 **异常（Exception）** ，被操作系统拦截。

常见的特权指令：

| **类别**     | **指令**     | **作用**                                       |
| ------------ | ------------ | ---------------------------------------------- |
| **CPU 控制** | `HLT`        | 停止 CPU（Halting the CPU）                    |
|              | `CLI`        | 关闭中断（Clear Interrupt Flag）               |
|              | `STI`        | 开启中断（Set Interrupt Flag）                 |
|              | `IRET`       | 从中断返回（Interrupt Return）                 |
| **内存管理** | `LGDT`       | 加载全局描述符表（GDT）                        |
|              | `LLDT`       | 加载局部描述符表（LDT）                        |
|              | `LTR`        | 加载任务寄存器（Task Register）                |
| **I/O 操作** | `IN` / `OUT` | 访问 I/O 端口（输入/输出设备）                 |
| **模式切换** | `MOV CRx`    | 修改控制寄存器（如 `CR0`, `CR3` 用于内存分页） |

常见的非特权指令:

| **类别**       | **指令**                 | **作用**       |
| -------------- | ------------------------ | -------------- |
| **数据传输**   | `MOV`                    | 数据传输       |
|                | `PUSH` / `POP`           | 堆栈操作       |
| **算术运算**   | `ADD` / `SUB`            | 加法 / 减法    |
|                | `MUL` / `DIV`            | 乘法 / 除法    |
| **逻辑运算**   | `AND` / `OR` / `XOR`     | 逻辑运算       |
| **分支控制**   | `JMP`                    | 无条件跳转     |
|                | `CALL` / `RET`           | 调用函数和返回 |
| **字符串操作** | `MOVS` / `LODS` / `STOS` | 字符串操作     |
| **浮点运算**   | `FADD` / `FSUB`          | 浮点加减       |

> 特权指令的作用:
> - **保护操作系统安全**：防止用户程序直接访问系统关键资源（如内存、设备）。
> - **防止系统崩溃**：如果用户程序能随意执行 `HLT`，整个计算机可能会被停止。
> - **控制资源访问**：比如 `MOV CR3` 控制内存分页表，决定进程的内存映射，不能让普通程序修改。

> 非特权指令的作用：
> - **用户程序可以自由执行**，不会影响系统安全。
> - **不涉及硬件资源管理**，不会访问 I/O 端口、修改内存映射等。
> - **适用于应用程序**，如计算、数据存储、逻辑判断等。

---

4. I/O 通道实际上是一种特殊的 **处理器** （也就是说是一种 **硬件技术**），它具有执行 I/O 指令的能力，并通过执行通道程序来控制 I/O 操作。

---

5. 系统调用需要触发 **陷入指令** 。

---

6. 用户程序在用户态下使用特权指令会引起 **访管中断（陷入终端）** ，即用户程序需要通过一条 **访管指令（陷入指令）** 切换到核心态，以请求操作系统内核为其服务。用户态 ——> 核心态是由 **硬件** 完成的。

---

7. 外部中断是由 CPU 外部的事件引起的，如 I/O 设备的请求、时钟信号等。内部中断（也称异常）是由 CPU 内部的事件引起的，如访管指令、缺页异常等。

---

8. 外部中断处理过程，PC 值由中断隐指令（也就是由 **硬件**）自动保存，而通用寄存器内容由操作系统保存。

---

# 4.操作系统结构

---

1. 分层式架构的特点：各层之间只能是单向依赖或单向调用（因此不能跨层次访问！）；容易实现在系统中增加或替换一层而不影响其它层；系统效率较低。

2. 模块化架构的特点：各功能模块都在内核中，且模块之间相互调用、相互依赖；须通过消息传递进行通信，效率高；但是任何一个模块出错，都可能导致整个内核崩溃。

3. 微内核架构：内核足够小；基于客户/服务器模式；应用“机制与策略分离”的原理；采用面向对象技术。

4. 宏内核架构：

---

5. 在拥有 **外核** 的操作系统中，外核只负责 **硬件资源的分配、回收、保护等** ，进程管理相关的工作仍然由内核负责。

---

# 5.操作系统引导

---

1. 操作系统进行初始化的过程中，创建的是 **中断向量表** 。

# 6.虚拟机

---















